(function(a,b,c,d){"use strict";a.images=[];a.options=a.options||{};var e=a.options,f=e.testConn||true,g=e.minKbpsForHighBandwidth||300,h=e.speedTestUri||"http://foresightjs.appspot.com/speed-test/50K",i=e.speedTestKB||50,j=e.speedTestExpireMinutes||30,k=e.hiResClassname||"fs-high-resolution",l=e.lowResClassname||"fs-standard-resolution",m="devicePixelRatio",n="devicePixelRatioRounded",o="bandwidth",p="connType",q="connTestResult",r="connKbps",s="requestChange",t="defaultSrc",u="highResolutionSrc",v="browserWidth",w="browserHeight",x="requestWidth",y="requestHeight",z="width",A="height",B="widthUnits",C="heightUnits",D="aspectRatio",E="appliedImageSetItem",F="scale",G="scaleRounded",H="uriTemplate",I="uriFind",J="uriReplace",K="srcModification",L="loading",M="complete",N="fsjs",O=true,P=false,Q=/url\((?:([a-zA-Z-_0-9{}\?=&\\/.:\s]+)|([a-zA-Z-_0-9{}\?=&\\/.:\s]+)\|([a-zA-Z-_0-9{}\?=&\\/.:\s]+))\)/g,R,S,T=function(){if(R)return;R=L;V();R=M;Z()},U=function(a,b){try{var d=c.createEvent("Event");d.initEvent("foresight-"+a,O,O);b.dispatchEvent(d)}catch(e){}},V=function(){var b,d,e;for(b=0;b<c.images.length;b++){d=c.images[b];if(d.ignore)continue;if(!d.initalized){d.initalized=O;U("imageInitStart",d);d[t]=Y(d,"src");d[B]=Y(d,z,O);d[C]=Y(d,A,O);var f=Y(d,"aspect-ratio",P);d[D]=f==="auto"?f:!isNaN(f)?parseInt(f,10):0;if(!d[t]||(!d[B]||!d[C])&&!d[D]){d.ignore=O;continue}d[u]=Y(d,"high-resolution-src");d.orgClassName=d.className?d.className:"";d.onerror=bk;U("imageInitEnd",d);a.images.push(d)}d.imageSetText=be(d,"font-family","fontFamily").split("image-set(");d.imageSet=[];if(d.imageSetText.length>1){W(d,d.imageSetText[1])}}},W=function(a,b){var c,d=b.split(","),e,f;for(c=0;c<d.length;c++){e={text:d[c],weight:0};if(e.text.indexOf(" 1.5x")>-1){e.weight++;e[F]=1.5}else if(e.text.indexOf(" 2x")>-1){e[F]=2}else if(e.text.indexOf(" 1x")>-1){e[F]=1}if(e.text.indexOf(" high-bandwidth")>-1){e[o]="high"}else if(e.text.indexOf(" low-bandwidth")>-1){e[o]="low"}while(f=Q.exec(e.text)){if(f[1]!=null&&f[1]!==""){e[H]=f[1];e.weight++}else if(f[2]!=null&&f[2]!==""){e[I]=f[2];e[J]=f[3];e.weight++}}if(e[F]&&e[o]){e.weight+=2}else if(e[F]||e[o]){e.weight++}a.imageSet.push(e)}a.imageSet.sort(X)},X=function(a,b){if(a.weight<b.weight)return 1;if(a.weight>b.weight)return-1;return 0},Y=function(a,b,c,d){d=a.getAttribute("data-"+b);if(c){if(!isNaN(d)){return parseInt(d,10)}return 0}return d},Z=function(){if(!(S===M&&R===M))return;var b,c=a.images.length,d,e,f,g,h=[],i;for(b=0;b<c;b++){d=a.images[b];if(!bb(d)){continue}U("imageRebuildStart",d);f=d.orgClassName.split(" ");bc(d);if(d.unitType=="pixel"){g="fs-"+d[v]+"x"+d[w];f.push(g);if(h[g]==undefined){h[g]=O;h.push("."+g+"{width:"+d[v]+"px;height:"+d[w]+"px}")}}if(d.style.display!=="inline"){d.style.display="inline"}ba(d);$(d);if(a.hiResEnabled&&d.src!==d[t]){f.push(k)}else{f.push(l)}f.push("fs-"+d[K]);d.className=f.join(" ");U("imageRebuildEnd",d)}if(h.length){bg(h)}if(a.updateComplete){a.updateComplete()}bo=bq()},$=function(b){var c,d;if(b[E][F]>1&&b[E][o]==="high"){c=b[v]===undefined?"auto":Math.round(b[v]*b[E][F]);d=b[w]===undefined?"auto":Math.round(b[w]*b[E][F]);a.hiResEnabled=O}else{c=b[v]===undefined?"auto":b[v];d=b[w]===undefined?"auto":b[w];a.hiResEnabled=P}if(!b[x]||c>b[x]||b.activeImageSet!==b.imageSetText){b[x]=c;b[y]=d;if(b[u]&&a.hiResEnabled){b.src=b[u];b[K]="src-hi-res"}else{b.src=_(b)}b[s]=O;b.activeImageSet=b.imageSetText}else{b[s]=P}},_=function(a){if(a[E][H]){a[K]="src-uri-template";return bh(a)}else if(a[E][I]&&a[E][J]){a[K]="src-find-replace";return bj(a)}a[K]="src-default";return a[t]},ba=function(b){var c,d,e={};for(c=0;c<b.imageSet.length;c++){d=b.imageSet[c];if(d[F]&&d[o]){if(a[m]==d[F]&&a[o]===d[o]){e=d;break}else if(Math.round(a[m])==d[F]&&a[o]===d[o]){e=d;break}}else if(d[F]){if(a[m]==d[F]){e=d;break}else if(Math.round(a[m])==d[F]){e=d;break}}else if(d[o]){if(a[o]===d[o]){e=d;break}}else{e=d}}if(!e[F]){e[F]=a[m]}if(!e[o]){e[o]=a[o]}e[G]=Math.round(e[F]);b[E]=e},bb=function(a,b){b=a.parentNode;if(b.clientWidth){return O}if(be(b,"display")==="inline"){return bb(b)}return P},bc=function(a,b){if(!a.unitType){b=be(a,z);if(b.indexOf("%")>0){a.unitType="percent"}else{a.unitType="pixel";if(a[D]&&a[D]!="auto"){if(a[B]){a[v]=a[B];a[w]=Math.round(a[B]/a[D])}else if(a[C]){a[v]=Math.round(a[HEIGHT_UNTIS]/a[D]);a[w]=a[C]}}else{a[v]=a[B];a[w]=a[C]}}}if(a.unitType==="percent"){a.computedWidth=bd(a);a[v]=a.computedWidth;if(a[D]!="auto"){a[w]=Math.round(a[v]/a[D])}else if(a[C]){a[w]=Math.round(a[C]*(a.computedWidth/a[B]))}if(a[w]&&d.appVersion.indexOf("MSIE")>-1){a.style.height=a[w]+"px"}}},bd=function(a){if(a.offsetWidth!==0){return a.offsetWidth}else{var b,c,d={},e={position:"absolute",visibility:"hidden",display:"block"};for(c in e){d[c]=a.style[c];a.style[c]=e[c]}b=a.offsetWidth;for(c in e){a.style[c]=d[c]}return b}},be=function(a,b,d){if(!d){d=b}return a.currentStyle?a.currentStyle[d]:c.defaultView.getComputedStyle(a,null).getPropertyValue(b)},bf,bg=function(a,b){if(!bf){bf=c.createElement("style");bf.setAttribute("type","text/css")}b=a.join("");try{bf.innerHTML=b}catch(d){bf.styleSheet.cssText=b}if(bf.parentElement==null){c.getElementsByTagName("head")[0].appendChild(bf)}},bh=function(a){var b,c=["src","protocol","host","port","directory","file","filename","ext","query",x,y,F,G],d=a[E][H];a.uri=bi(a[t]);a.uri.src=a[t];a.uri[x]=a[x];a.uri[y]=a[y];a.uri[F]=a[E][F];a.uri[G]=a[E][G];for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}return d},bi=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},bj=function(a){var b=a[E][I].replace("{browserWidth}",a[B]).replace("{browserHeight}",a[C]);var c,d=a[t].replace(b,a[E][J]),e=[x,y,F,G];for(c=0;c<e.length;c++){d=d.replace("{"+e[c]+"}",a[e[c]])}return d},bk=function(a){a=this;a.className=a.className.replace(k,l);a[K]="response-error";if(a.hasError||a.src===a[t])return;a.hasError=O;a.src=a[t]},bl=function(){if(S)return;if(e.forcedBandwidth){a[o]=e.forcedBandwidth;a[q]="forced";S=M;return}if(a[m]===1){a[q]="skip";S=M;return}var b=d.connection||{type:"unknown"};var f=b.type==3||b.type==4||/^[23]g$/.test(b.type);a[p]=b.type;if(f){a[q]="connTypeSlow";S=M;return}try{var j=JSON.parse(localStorage.getItem(N));if(j!==null){if((new Date).getTime()<j.exp){a[o]=j.bw;a[r]=j.kbps;a[q]="localStorage";S=M;return}}}catch(k){}var l=c.createElement("img"),n,s,t;l.onload=function(){n=(new Date).getTime();var b=(n-s)/1e3;b=b>1?b:1;a[r]=i*1024*8/b/1024;a[o]=a[r]>=g?"high":"low";bm("networkSuccess")};l.onerror=function(){bm("networkError",5)};l.onabort=function(){bm("networkAbort",5)};s=(new Date).getTime();S=L;if(c.location.protocol==="https:"){h=h.replace("http:","https:")}l.src=h+"?r="+Math.random();t=i*8/g*1e3+350;setTimeout(function(){bm("networkSlow")},t)},bm=function(b,c){if(S===M)return;S=M;a[q]=b;try{if(!c){c=j}var d={kbps:a[r],bw:a[o],exp:(new Date).getTime()+c*6e4};localStorage.setItem(N,JSON.stringify(d))}catch(e){}Z()},bn=function(){if(b.addEventListener){b.addEventListener("resize",bp,P)}else if(b.attachEvent){b.attachEvent("onresize",bp)}},bo=0,bp=function(){if(bo!==bq()){a.reload()}},bq=function(){return c.documentElement.clientWidth||c.body&&c.body.clientWidth||1024},br,bs=function(){if(R!==M||S!==M)return;V();Z()};a.resolve=function(a,b){b.imageSet=[];W(b,a);ba(b);$(b);b.src=_(b)};a.reload=function(){b.clearTimeout(br);br=b.setTimeout(bs,250)};a.ready=function(){if(!c.body){return b.setTimeout(a.ready,1)}T()};if(c.readyState===M){setTimeout(a.ready,1)}else{if(c.addEventListener){c.addEventListener("DOMContentLoaded",a.ready,P);b.addEventListener("load",a.ready,P)}else if(c.attachEvent){c.attachEvent("onreadystatechange",a.ready);b.attachEvent("onload",a.ready)}}a[m]=b[m]?b[m]:1;if(e.forcedPixelRatio){a[m]=e.forcedPixelRatio}a[n]=Math.round(a[m]);bl();bn()})(this.foresight=this.foresight||{},this,document,navigator)