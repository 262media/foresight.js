(function(a,b,c,d){"use strict";a.images=[];a.options=a.options||{};var e=a.options,f=e.testConn||true,g=e.minKbpsForHighBandwidth||400,h=e.speedTestUri||"http://foresightjs.appspot.com/speed-test/50K",i=e.speedTestKB||50,j=e.speedTestExpireMinutes||30,k=e.knownSlowConnections||["2g","3g"],l="devicePixelRatio",m="devicePixelRatioRounded",n="bandwidth",o="connType",p="connTestResult",q="connKbps",r="requestChange",s="highResolutionSrc",t="browserWidth",u="browserHeight",v="requestWidth",w="requestHeight",x="width",y="height",z="widthUnits",A="heightUnits",B="scale",C="scaleRounded",D="uriTemplate",E="srcModification",F="loading",G="complete",H="fsjs",I=true,J=false,K,L,M=function(){if(K)return;K=F;N();K=G;Q()},N=function(){var b,d,e,f;for(b=0;b<c.images.length;b++){d=c.images[b];if(d.initalized)continue;d.initalized=I;d.orgSrc=P(d,"src");d[z]=P(d,x,I);d[A]=P(d,y,I);if(!d.orgSrc||!d[z]||!d[A])continue;d[v]=0;d[w]=0;d[s]=P(d,"high-resolution-src");d.orgClassName=d.className?d.className:"";f=U(d,"font-family","fontFamily").split("image-set(");d.imageSet=[];d.imageSet.push({uriTemplate:null,scale:a[l],bandwidth:a[n],text:null});if(f.length>1){O(d,f[1])}d.onerror=$;a.images.push(d)}},O=function(a,b){var c,d=b.split(","),e,f,g=/url\((?:([a-zA-Z-_0-9{}\\//.:\s]+))\)/g;for(c=0;c<d.length;c++){e={uriTemplate:null,scale:null,bandwidth:null,text:d[c]};if(e.text.indexOf(" 2x")>-1){e[B]=2}else if(e.text.indexOf(" 1.5x")>-1){e[B]=1.5}if(e.text.indexOf("high-bandwidth")>-1){e[n]="high"}else if(e.text.indexOf("low-bandwidth")>-1){e[n]="low"}while(f=g.exec(e.text)){if(f[1]!=null){e[D]=f[1]}}a.imageSet.push(e)}},P=function(a,b,c,d){d=a.getAttribute("data-"+b);if(c){if(!isNaN(d)){return parseInt(d,10)}return 0}return d},Q=function(){if(!(L===G&&K===G))return;var b,c,d=a.images.length,e,f,g,h,i,j,k,o=[],p,q;for(b=0;b<d;b++){e=a.images[b];if(!R(e)){continue}i=e.orgClassName.split(" ");S(e);if(e.unitType=="pixel"){k="fs-"+e[t]+"x"+e[u];i.push(k);o.push("."+k+"{width:"+e[t]+"px;height:"+e[u]+"px}")}if(e.style.display!=="inline"){e.style.display="inline"}for(c=0;c<e.imageSet.length;c++){q=e.imageSet[c];if(a[n]===q[n]&&a[l]===q[B]){e[D]=q[D];e[B]=q[B];e[n]=q[n]}else if(a[n]===q[n]&&a[m]===Math.round(q[B])){e[D]=q[D];e[B]=q[B];e[n]=q[n]}else if(a[l]===q[B]){e[D]=q[D];e[B]=q[B]}else if(a[n]===q[n]){e[D]=q[D];e[n]=q[n]}}e[C]=Math.round(e[B]);if(e[n]==="high"&&e[B]>1){f=Math.round(e[t]*e[B]);g=Math.round(e[u]*e[B]);a.hiResEnabled=I;i.push("fs-high-resolution")}else{f=e[t];g=e[u];a.hiResEnabled=J;i.push("fs-standard-resolution")}if(f>e[v]){e[v]=f;e[w]=g;if(e[s]&&a.hiResEnabled){if(e[s]!==e.src){e.src=e[s]}e[E]="src-hi-res"}else if(e[D]){X(e);e[E]="src-uri-template"}else{Z(e);e[E]="src-replace-dimensions"}e[r]=I}else{e[r]=J}i.push("fs-"+e[E]);e.className=i.join(" ")}if(o.length){W(o)}if(a.updateComplete){a.updateComplete()}bc=be()},R=function(a,b){b=a.parentElement;if(b.clientWidth){return I}if(U(b,"display")==="inline"){return R(b)}return J},S=function(a,b){if(!a.unitType){b=U(a,x);if(b.indexOf("%")>0){a.unitType="percent"}else{a.unitType="pixel";a[t]=a[z];a[u]=a[A]}}if(a.unitType==="percent"){a.computedWidth=T(a);a[t]=a.computedWidth;a[u]=Math.round(a[A]*(a.computedWidth/a[z]));a.style.height=a[u]+"px"}},T=function(a){if(a.offsetWidth!==0){return a.offsetWidth}else{var b,c,d={},e={position:"absolute",visibility:"hidden",display:"block"};for(c in e){d[c]=a.style[c];a.style[c]=e[c]}b=a.offsetWidth;for(c in e){a.style[c]=d[c]}return b}},U=function(a,b,d){if(!d){d=b}return a.currentStyle?a.currentStyle[d]:c.defaultView.getComputedStyle(a,null).getPropertyValue(b)},V,W=function(a,b){if(!V){V=c.createElement("style");V.setAttribute("type","text/css")}b=a.join("");try{V.innerText=b}catch(d){V.styleSheet.cssText=b}if(V.parentElement==null){c.getElementsByTagName("head")[0].appendChild(V)}},X=function(a){var b,c=["src","protocol","host","port","directory","file","filename","ext","query",v,w,B,C],d=a[D];a.uri=Y(a.orgSrc);a.uri.src=a.orgSrc;a.uri[v]=a[v];a.uri[w]=a[w];a.uri[B]=a[B];a.uri[C]=a[C];for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}if(d!==a.src){a.src=d}},Y=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},Z=function(a,b){b=a.orgSrc;if(a[z]!==a[v]){b=b.replace(a[z],"{requestWidth}").replace(a[A],"{requestHeight}");b=b.replace("{requestWidth}",a[v]).replace("{requestHeight}",a[w])}if(a.src!==b){a.src=b}},$=function(a){a=this;if(a.hadError)return;a.hadError=I;a.src=a.orgSrc;a[E]="response-error"},_=function(){if(L)return;if(e.forcedBandwidth){a[n]=e.forcedBandwidth;a[p]="forced";L=G;return}if(a[l]===1){a[p]="skip";L=G;return}a[o]=d.connection&&d.connection.type?d.connection.type.toString().toLowerCase():"unknown";if(a[o]!=="unknown"){for(var b=0;b<k.length;b++){if(a[o].indexOf(k[b])>-1){a[p]="connTypeSlow";L=G;return}}}try{var f=JSON.parse(localStorage.getItem(H));if(f!==null){if((new Date).getTime()<f.exp){a[n]=f.bw;a[q]=f.kbps;a[p]="localStorage";L=G;return}}}catch(j){}var m=c.createElement("img"),r,s,t;m.onload=function(){r=(new Date).getTime();var b=(r-s)/1e3;b=b>1?b:1;a[q]=i*1024*8/b/1024;a[n]=a[q]>=g?"high":"low";ba("networkSuccess")};m.onerror=function(){ba("networkError",5)};m.onabort=function(){ba("networkAbort",5)};s=(new Date).getTime();L=F;if(c.location.protocol==="https:"){h=h.replace("http:","https:")}m.src=h+"?r="+Math.random();t=i*8/g*1e3+350;setTimeout(function(){ba("networkSlow")},t)},ba=function(b,c){if(L===G)return;L=G;a[p]=b;try{if(!c){c=j}var d={kbps:a[q],bw:a[n],exp:(new Date).getTime()+c*6e4};localStorage.setItem(H,JSON.stringify(d))}catch(e){}Q()},bb=function(){if(b.addEventListener){b.addEventListener("resize",bd,J)}else if(b.attachEvent){b.attachEvent("onresize",bd)}},bc=0,bd=function(){if(bc!==be()){a.reload()}},be=function(){return c.documentElement.clientWidth||c.body&&c.body.clientWidth||1024},bf,bg=function(){if(K!==G||L!==G)return;N();Q()};a.reload=function(){b.clearTimeout(bf);bf=b.setTimeout(bg,250)};a.ready=function(){if(!c.body){return b.setTimeout(ready,1)}M()};if(c.readyState===G){setTimeout(fsReady,1)}else{if(c.addEventListener){c.addEventListener("DOMContentLoaded",a.ready,J);b.addEventListener("load",a.ready,J)}else if(c.attachEvent){c.attachEvent("onreadystatechange",a.ready);b.attachEvent("onload",a.ready)}}a[l]=b[l]?b[l]:1;if(e.forcedPixelRatio){a[l]=e.forcedPixelRatio}a[m]=Math.round(a[l]);_();bb()})(foresight=foresight||{},this,document,navigator)