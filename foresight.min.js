(function(a,b,c,d){"use strict";a.devicePixelRatio=b.devicePixelRatio&&b.devicePixelRatio>1?b.devicePixelRatio:1;a.bandwidth="low";a.connKbps;a.connTestResult;a.connType;a.images=[];a.options=a.options||{};var e=a.options,f=e.testConn||true,g=e.minKbpsForHighSpeedConn||400,h=e.speedTestUri||"http://foresightjs.appspot.com/speed-test/50K",i=e.speedTestKB||50,j=e.speedTestExpireMinutes||30,k,l,m="loading",n="complete",o="fsjs",p="browserWidth",q="browserHeight",r="requestWidth",s="requestHeight",t="width",u="height",v=true,w=false,x=function(){if(k)return;k=m;y();k=n;C()},y=function(){var b,d,e,f=/url\((?:([a-zA-Z-_0-9{}\\//.:\s]+))\)/g,g,h,i,j,k;for(b=0;b<c.images.length;b++){d=c.images[b];if(!d.initalized){d.initalized=v;d.orgSrc=z(d,"src");d.widthUnits=z(d,t,true);d.heightUnits=z(d,u,true);if(!d.orgSrc||!d.widthUnits||!d.heightUnits)continue;d[r]=0;d[s]=0;d.highResolutionSrc=z(d,"high-resolution-src");d.orgClassName=d.className?d.className:"";g=A(d,"font-family","fontFamily").split("image-set(");d.imageSet=[];if(g.length>1){h=g[1].split(",");for(j=0;j<h.length;j++){i={uriTemplate:null,scaleFactor:1,bandwidth:"low",text:h[j]};if(i.text.indexOf(" 2x")>-1){i.scaleFactor=2}else if(i.text.indexOf(" 1.5x")>-1){i.scaleFactor=1.5}if(i.text.indexOf("high-bandwidth")>-1){i.bandwidth="high"}while(k=f.exec(i.text)){if(k[1]!=null){i.uriTemplate=k[1]}}d.imageSet.push(i)}}a.images.push(d)}}},z=function(a,b,c){var d=a.getAttribute("data-"+b);if(c){return B(d)}return d},A=function(a,b,d){return a.currentStyle?a.currentStyle[d]:c.defaultView.getComputedStyle(a,null).getPropertyValue(b)},B=function(a){if(!isNaN(a)){return parseInt(a,10)}return 0},C=function(){if(!(l===n&&k===n))return;if(e.forcedPixelRatio){a.devicePixelRatio=e.forcedPixelRatio}if(e.forcedBandwidth){a.bandwidth=e.forcedBandwidth}var c,d=a.images.length,f,g,h,i,j,m,o,u=[],x,y,z;for(c=0;c<d;c++){f=a.images[c];if(!f.parentElement.clientWidth){continue}j=f.orgClassName.split(" ");x=A(f,t,t);if(x.indexOf("%")>0){if(!f.unitType){f.style.display="block";f.unitType="percent";x=A(f,t,t);f.computedWidth=B(x.replace("px",""));f.style.display="inline"}f[p]=f.computedWidth;f[q]=Math.round(f.heightUnits*(f.computedWidth/f.widthUnits))}else if(!f.unitType){f.unitType="pixel";f[p]=f.widthUnits;f[q]=f.heightUnits;f.style.display="inline";o="fs-"+f[p]+"x"+f[q];j.push(o);u.push("."+o+"{width:"+f[p]+"px;height:"+f[q]+"px}")}f.uriTemplate=null;f.scaleFactor=1;f.bandwidth="low";for(y=0;y<f.imageSet.length;y++){z=f.imageSet[y];if(a.bandwidth===z.bandwidth&&a.devicePixelRatio===z.scaleFactor){f.uriTemplate=z.uriTemplate;f.scaleFactor=z.scaleFactor;f.bandwidth=z.bandwidth}else if(a.devicePixelRatio===z.scaleFactor){f.uriTemplate=z.uriTemplate;f.scaleFactor=z.scaleFactor}else if(a.bandwidth===z.bandwidth){f.uriTemplate=z.uriTemplate;f.bandwidth=z.bandwidth}}if(z.bandwidth==="high"&&z.scaleFactor>1){g=Math.round(f[p]*z.scaleFactor);h=Math.round(f[q]*z.scaleFactor);a.hiResEnabled=v;j.push("fs-high-resolution")}else{g=f[p];h=f[q];a.hiResEnabled=w;j.push("fs-standard-resolution")}if(g>f[r]){f[r]=g;f[s]=h;if(f.highResolutionSrc&&a.hiResEnabled){if(f.highResolutionSrc!==f.src){f.src=f.highResolutionSrc}f.srcModification="src-hi-res"}else if(f.uriTemplate){F(f);f.srcModification="src-uri-template"}else{H(f);f.srcModification="src-replace-dimensions"}}j.push("fs-"+f.srcModification);f.className=j.join(" ")}if(u.length){E(u)}if(a.updateComplete){a.updateComplete()}L=b.innerWidth},D,E=function(a){if(!D){D=c.createElement("style");D.setAttribute("type","text/css")}var b=a.join("");try{D.innerText=b}catch(d){D.styleSheet.cssText=b}if(D.parentElement==null){c.getElementsByTagName("head")[0].appendChild(D)}},F=function(b){var c,d=["protocol","host","port","directory","file","filename","ext","query","requestWidth","requestHeight","pixelRatio"],e=b.uriTemplate;b.uri=G(b.orgSrc);b.uri.requestWidth=b[r];b.uri.requestHeight=b[s];b.uri.pixelRatio=a.devicePixelRatio;for(c=0;c<d.length;c++){e=e.replace("{"+d[c]+"}",b.uri[d[c]])}if(e!==b.src){b.src=e}},G=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},H=function(a){var b=a.orgSrc.replace(a.widthUnits,"{requestWidth}").replace(a.heightUnits,"{requestHeight}");b=b.replace("{requestWidth}",a[r]).replace("{requestHeight}",a[s]);if(a.src!==b){a.src=b}},I=function(){if(l)return;if(a.devicePixelRatio===1){a.connTestResult="skip";l=n;return}a.connType=d.connection&&d.connection.type?d.connection.type.toString().toLowerCase():"unknown";if(a.connType!=="unknown"){var b,e=["2g","3g"];for(b=0;b<e.length;b++){if(a.connType.indexOf(e[b])>-1){a.connTestResult="connTypeSlow";l=n;return}}}try{var f=JSON.parse(localStorage.getItem(o));if(f!==null){var k=((new Date).getTime()-f.timestamp)/1e3/60;if(k<j){a.bandwidth=f.bandwidth;a.connKbps=f.connKbps;a.connTestResult="localStorage";l=n;return}}}catch(p){}var q=c.createElement("img"),r,s,t;q.onload=function(){r=(new Date).getTime();var b=(r-s)/1e3;b=b>1?b:1;var c=i*1024*8;a.connKbps=c/b/1024;a.bandwidth=a.connKbps>=g?"high":"low";J("networkSuccess")};q.onerror=function(){J("networkError")};s=(new Date).getTime();l=m;if(c.location.protocol==="https:"){h=h.replace("http:","https:")}q.src=h+"?r="+Math.random();t=i*8/g*1e3+350;setTimeout(function(){J("networkSlow")},t)},J=function(b){if(l===n)return;l=n;a.connTestResult=b;try{var c={connKbps:a.connKbps,bandwidth:a.bandwidth,timestamp:(new Date).getTime()};localStorage.setItem(o,JSON.stringify(c))}catch(d){}C()},K=function(){if(b.addEventListener){b.addEventListener("resize",M,w)}else if(b.attachEvent){b.attachEvent("onresize",M)}},L=0,M=function(){if(L!==b.innerWidth){a.reload()}},N,O=function(){if(k!==n||l!==n)return;y();C()};a.reload=function(){b.clearTimeout(N);N=b.setTimeout(O,400)};if(c.readyState===n){x()}else{if(c.addEventListener){c.addEventListener("DOMContentLoaded",x,w);b.addEventListener("load",x,w)}else if(c.attachEvent){c.attachEvent("onreadystatechange",x);b.attachEvent("onload",x)}}I();K()})(this.foresight=this.foresight||{},this,document,navigator)