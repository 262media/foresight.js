(function(a,b,c,d){"use strict";a.images=[];a.options=a.options||{};var e=a.options,f=e.testConn||true,g=e.minKbpsForHighBandwidth||400,h=e.speedTestUri||"http://foresightjs.appspot.com/speed-test/50K",i=e.speedTestKB||50,j=e.speedTestExpireMinutes||30,k=e.knownSlowConnections||["2g","3g"],l=e.hiResClassname||"fs-high-resolution",m=e.lowResClassname||"fs-standard-resolution",n="devicePixelRatio",o="devicePixelRatioRounded",p="bandwidth",q="connType",r="connTestResult",s="connKbps",t="requestChange",u="highResolutionSrc",v="browserWidth",w="browserHeight",x="requestWidth",y="requestHeight",z="width",A="height",B="widthUnits",C="heightUnits",D="scale",E="scaleRounded",F="uriTemplate",G="uriFind",H="uriReplace",I="srcModification",J="loading",K="complete",L="fsjs",M=true,N=false,O=/url\((?:([a-zA-Z-_0-9{}\\/.:\s]+)|([a-zA-Z-_0-9{}\\/.:\s]+)\|([a-zA-Z-_0-9{}\\/.:\s]+))\)/g,P,Q,R=function(){if(P)return;P=J;S();P=K;V()},S=function(){var b,d,e,f;for(b=0;b<c.images.length;b++){d=c.images[b];if(d.initalized)continue;d.initalized=M;d.orgSrc=U(d,"src");d[B]=U(d,z,M);d[C]=U(d,A,M);if(!d.orgSrc||!d[B]||!d[C])continue;d[x]=0;d[y]=0;d[u]=U(d,"high-resolution-src");d.orgClassName=d.className?d.className:"";f=$(d,"font-family","fontFamily").split("image-set(");d.imageSet=[];d.imageSet.push({uriTemplate:null,uriFind:null,uriReplace:null,scale:a[n],bandwidth:a[p],text:null});if(f.length>1){T(d,f[1])}d.onerror=be;a.images.push(d)}},T=function(a,b){var c,d=b.split(","),e,f;for(c=0;c<d.length;c++){e={uriTemplate:null,uriFind:null,uriReplace:null,scale:null,bandwidth:null,text:d[c]};if(e.text.indexOf(" 2x")>-1){e[D]=2}else if(e.text.indexOf(" 1.5x")>-1){e[D]=1.5}else if(e.text.indexOf(" 1x")>-1){e[D]=1}if(e.text.indexOf("high-bandwidth")>-1){e[p]="high"}else if(e.text.indexOf("low-bandwidth")>-1){e[p]="low"}while(f=O.exec(e.text)){if(f[1]!=null){e[F]=f[1]}else if(f[2]!=null&&f[3]!=null){e[G]=f[2];e[H]=f[3]}}a.imageSet.push(e)}},U=function(a,b,c,d){d=a.getAttribute("data-"+b);if(c){if(!isNaN(d)){return parseInt(d,10)}return 0}return d},V=function(){if(!(Q===K&&P===K))return;var b,c,d=a.images.length,e,f,g,h,i,j,k=[],q,r;for(b=0;b<d;b++){e=a.images[b];if(!X(e)){continue}i=e.orgClassName.split(" ");Y(e);if(e.unitType=="pixel"){j="fs-"+e[v]+"x"+e[w];i.push(j);k.push("."+j+"{width:"+e[v]+"px;height:"+e[w]+"px}")}if(e.style.display!=="inline"){e.style.display="inline"}for(c=0;c<e.imageSet.length;c++){r=e.imageSet[c];if(a[p]===r[p]&&a[n]===r[D]){W(e,r)}else if(a[p]===r[p]&&a[o]===Math.round(r[D])){W(e,r)}else if(a[n]===r[D]){W(e,r)}else if(a[p]===r[p]){W(e,r)}}e[E]=Math.round(e[D]);if(e[p]==="high"&&e[D]>1){f=Math.ceil(e[v]*e[D]);g=Math.ceil(e[w]*e[D]);a.hiResEnabled=M}else{f=e[v];g=e[w];a.hiResEnabled=N}if(f>e[x]){e[x]=f;e[y]=g;if(e[u]&&a.hiResEnabled){e.src=e[u];e[I]="src-hi-res"}else if(e[F]){bb(e);e[I]="src-uri-template"}else if(e[G]&&e[H]){bd(e);e[I]="src-replace-dimensions"}else{e.src=e.orgSrc;e[I]="src-original"}e[t]=M}else{e[t]=N}if(a.hiResEnabled&&e.src!==e.orgSrc){i.push(l)}else{i.push(m)}i.push("fs-"+e[I]);e.className=i.join(" ")}if(k.length){ba(k)}if(a.updateComplete){a.updateComplete()}bi=bk()},W=function(a,b){var c,d=[F,G,H,D,p];for(c=0;c<d.length;c++){a[d[c]]=b[d[c]]}},X=function(a,b){b=a.parentElement;if(b.clientWidth){return M}if($(b,"display")==="inline"){return X(b)}return N},Y=function(a,b){if(!a.unitType){b=$(a,z);if(b.indexOf("%")>0){a.unitType="percent"}else{a.unitType="pixel";a[v]=a[B];a[w]=a[C]}}if(a.unitType==="percent"){a.computedWidth=Z(a);a[v]=a.computedWidth;a[w]=Math.round(a[C]*(a.computedWidth/a[B]));a.style.height=a[w]+"px"}},Z=function(a){if(a.offsetWidth!==0){return a.offsetWidth}else{var b,c,d={},e={position:"absolute",visibility:"hidden",display:"block"};for(c in e){d[c]=a.style[c];a.style[c]=e[c]}b=a.offsetWidth;for(c in e){a.style[c]=d[c]}return b}},$=function(a,b,d){if(!d){d=b}return a.currentStyle?a.currentStyle[d]:c.defaultView.getComputedStyle(a,null).getPropertyValue(b)},_,ba=function(a,b){if(!_){_=c.createElement("style");_.setAttribute("type","text/css")}b=a.join("");try{_.innerText=b}catch(d){_.styleSheet.cssText=b}if(_.parentElement==null){c.getElementsByTagName("head")[0].appendChild(_)}},bb=function(a){var b,c=["src","protocol","host","port","directory","file","filename","ext","query",x,y,D,E],d=a[F];a.uri=bc(a.orgSrc);a.uri.src=a.orgSrc;a.uri[x]=a[x];a.uri[y]=a[y];a.uri[D]=a[D];a.uri[E]=a[E];for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}a.src=d},bc=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},bd=function(a){a[G]=a[G].replace("{browserWidth}",a[B]).replace("{browserHeight}",a[C]);var b,c=a.orgSrc.replace(a[G],a[H]),d=[x,y,D,E];for(b=0;b<d.length;b++){c=c.replace("{"+d[b]+"}",a[d[b]])}a.src=c},be=function(a){a=this;a.className=a.className.replace(l,m);a[I]="response-error";if(a.hasError||a.src===a.orgSrc)return;a.hasError=M;a.src=a.orgSrc},bf=function(){if(Q)return;if(e.forcedBandwidth){a[p]=e.forcedBandwidth;a[r]="forced";Q=K;return}if(a[n]===1){a[r]="skip";Q=K;return}a[q]=d.connection&&d.connection.type?d.connection.type.toString().toLowerCase():"unknown";if(a[q]!=="unknown"){for(var b=0;b<k.length;b++){if(a[q].indexOf(k[b])>-1){a[r]="connTypeSlow";Q=K;return}}}try{var f=JSON.parse(localStorage.getItem(L));if(f!==null){if((new Date).getTime()<f.exp){a[p]=f.bw;a[s]=f.kbps;a[r]="localStorage";Q=K;return}}}catch(j){}var l=c.createElement("img"),m,o,t;l.onload=function(){m=(new Date).getTime();var b=(m-o)/1e3;b=b>1?b:1;a[s]=i*1024*8/b/1024;a[p]=a[s]>=g?"high":"low";bg("networkSuccess")};l.onerror=function(){bg("networkError",5)};l.onabort=function(){bg("networkAbort",5)};o=(new Date).getTime();Q=J;if(c.location.protocol==="https:"){h=h.replace("http:","https:")}l.src=h+"?r="+Math.random();t=i*8/g*1e3+350;setTimeout(function(){bg("networkSlow")},t)},bg=function(b,c){if(Q===K)return;Q=K;a[r]=b;try{if(!c){c=j}var d={kbps:a[s],bw:a[p],exp:(new Date).getTime()+c*6e4};localStorage.setItem(L,JSON.stringify(d))}catch(e){}V()},bh=function(){if(b.addEventListener){b.addEventListener("resize",bj,N)}else if(b.attachEvent){b.attachEvent("onresize",bj)}},bi=0,bj=function(){if(bi!==bk()){a.reload()}},bk=function(){return c.documentElement.clientWidth||c.body&&c.body.clientWidth||1024},bl,bm=function(){if(P!==K||Q!==K)return;S();V()};a.reload=function(){b.clearTimeout(bl);bl=b.setTimeout(bm,250)};a.ready=function(){if(!c.body){return b.setTimeout(ready,1)}R()};if(c.readyState===K){setTimeout(fsReady,1)}else{if(c.addEventListener){c.addEventListener("DOMContentLoaded",a.ready,N);b.addEventListener("load",a.ready,N)}else if(c.attachEvent){c.attachEvent("onreadystatechange",a.ready);b.attachEvent("onload",a.ready)}}a[n]=b[n]?b[n]:1;if(e.forcedPixelRatio){a[n]=e.forcedPixelRatio}a[o]=Math.round(a[n]);bf();bh()})(foresight=foresight||{},this,document,navigator)