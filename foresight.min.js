(function(a,b){"use strict";a.foresight=a.foresight||{};var c=a.foresight;c.devicePixelRatio=a.devicePixelRatio&&a.devicePixelRatio>1?a.devicePixelRatio:1;c.isHighSpeedConn=false;c.hiResEnabled=false;c.connKbps=0;c.connTestMethod=undefined;c.images=[];c.options=c.options||{};var d=c.options,e=d.srcModification||"replaceDimensions",f=d.srcFormat||"{protocol}://{host}{directory}{file}",g=d.testConn||true,h=d.minKbpsForHighSpeedConn||800,i=d.speedTestUri||"http://foresightjs.appspot.com/speed-test/100K.jpg",j=d.speedTestKB||100,k=d.speedTestExpireMinutes||30,l=d.maxBrowserWidth||1024,m=d.maxBrowserHeight||l,n=d.maxRequestWidth||2048,o=d.maxRequestHeight||n,p=d.forcedPixelRatio,q,r,s="loading",t="complete",u="fsjs",v=true,w=false,x=function(){if(q)return;q=s;for(var a=0;a<b.images.length;a++){A(b.images[a])}q=t;D()},y=function(){if(r)return;if(c.devicePixelRatio==1){c.connTestMethod="skip";r=t;return}try{var a=JSON.parse(localStorage.getItem(u));if(a&&a.isHighSpeedConn){var d=((new Date).getTime()-a.timestamp)/1e3/60;if(d<k){c.isHighSpeedConn=v;c.connKbps=a.connKbps;c.connTestMethod="localStorage";r=t;return}}}catch(e){}var f=b.createElement("img"),g,l,m;f.onload=function(){g=(new Date).getTime();var a=I((g-l)/1e3);a=a>1?a:1;var b=j*1024*8;c.connKbps=I(b/a)/1024;c.isHighSpeedConn=c.connKbps>=h;z("networkSuccess")};f.onerror=function(){z("networkError")};l=(new Date).getTime();r=s;if(b.location.protocol==="https:"){i=i.replace("http:","https:")}f.src=i+"?r="+Math.random();m=j*8/h*1e3+250;setTimeout(function(){z("networkSlow")},m)},z=function(a){if(r===t)return;c.connTestMethod=a;try{var b={connKbps:c.connKbps,isHighSpeedConn:c.isHighSpeedConn,timestamp:(new Date).getTime()};localStorage.setItem(u,JSON.stringify(b))}catch(d){}r=t;D()},A=function(a){B(a,"src","orgSrc");if(!a.orgSrc||a.width==0||a.height==0||a.parentElement.clientWidth==0||a.parentElement.clientHeight==0)return;if(!a.initalized){a.initalized=v;a.orgWidth=a.width;a.orgHeight=a.height;a.requestWidth=0;a.requestHeight=0;a.orgClassName=a.className;B(a,"max-width","maxWidth",v,l);B(a,"max-height","maxHeight",v,m);B(a,"max-request-width","maxRequestWidth",v,n);B(a,"max-request-height","maxRequestHeight",v,o);B(a,"width-percent","widthPercent",v,0);B(a,"height-percent","heightPercent",v,0);B(a,"src-modification","srcModification",w,e);B(a,"src-format","srcFormat",w,f);B(a,"pixel-ratio","pixelRatio",v,c.devicePixelRatio);B(a,"src-high-resolution","highResolution",w);if(!a.id){a.id="fsImg"+Math.round(Math.random()*1e7)}c.images.push(a)}C(a);E(a,"width","maxWidth","height","maxHeight");var b=a.orgClassName?a.orgClassName.split(" "):[];b.push(a.pixelRatio>1?"fs-high-resolution":"fs-standard-resolution");b.push("fs-pixel-ratio-"+a.pixelRatio.toFixed(1).replace(".","_"));a.className=b.join(" ")},B=function(a,b,c,d,e){var f=a.getAttribute("data-"+b);if(f&&f!==""){if(d){f=f.replace("%","");if(!isNaN(f)){f=parseFloat(f,10)}}}else{f=e}a[c]=f},C=function(a){if(a.widthPercent>0){var b=a.width;a.width=I(a.widthPercent/100*a.parentElement.clientWidth);a.height=I(a.height*(a.width/b))}else if(a.heightPercent>0){var c=a.height;a.height=I(a.heightPercent/100*a.parentElement.clientHeight);a.width=I(a.width*(a.height/c))}},D=function(){if(r===t&&q===t){if(c.isHighSpeedConn&&c.devicePixelRatio>1){c.hiResEnabled=v}var a,b,d,e,f;for(a=0;a<c.images.length;a++){b=c.images[a];f=w;d=I(b.width*b.pixelRatio);if(d>b.requestWidth){b.requestWidth=d;f=v}e=I(b.height*b.pixelRatio);if(e>b.requestHeight){b.requestHeight=e;f=v}if(f){E(b,"requestWidth","maxRequestWidth","requestHeight","maxRequestHeight");if(b.highResolution&&c.hiResEnabled){b.src=b.highResolution}else if(b.srcModification==="rebuildSrc"&&b.srcFormat){F(b)}else{H(b)}}}if(c.oncomplete){c.oncomplete()}}},E=function(a,b,c,d,e){var f;if(a[b]>a[c]){f=a[b];a[b]=a[c];a[d]=I(a[d]*(a[b]/f))}if(a[d]>a[e]){f=a[d];a[d]=a[e];a[b]=I(a[b]*(a[d]/f));if(a[b]>a[c]){f=a.img[b];a[b]=a[c];a[d]=I(a[d]*(a[b]/f))}}},F=function(a){var b,c=["protocol","host","port","directory","file","filename","ext","query","requestWidth","requestHeight","pixelRatio"],d=a.srcFormat;a.uri=G(a.orgSrc);a.uri.requestWidth=a.requestWidth;a.uri.requestHeight=a.requestHeight;a.uri.pixelRatio=a.pixelRatio;for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}a.src=d},G=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},H=function(a){a.src=a.orgSrc.replace(a.orgWidth,a.requestWidth).replace(a.orgHeight,a.requestHeight)},I=function(a){return Math.round(a)},J=function(){if(a.addEventListener){a.addEventListener("resize",c.reload,w)}else if(a.attachEvent){a.attachEvent("onresize",c.reload)}},K,L=function(){if(q!==t||r!==t)return;for(var a=0;a<b.images.length;a++){A(b.images[a])}D()};c.reload=function(){a.clearTimeout(K);K=a.setTimeout(L,250)};if(p){c.devicePixelRatio=p}if(b.readyState===t){x()}else{if(b.addEventListener){b.addEventListener("DOMContentLoaded",x,w);a.addEventListener("load",x,w)}else if(b.attachEvent){b.attachEvent("onreadystatechange",x);a.attachEvent("onload",x)}}y();J()})(this,document)