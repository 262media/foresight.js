(function(a,b){"use strict";a.foresight=a.foresight||{};var c=a.foresight;c.devicePixelRatio=a.devicePixelRatio&&a.devicePixelRatio>1?a.devicePixelRatio:1;c.isHighSpeedConn=false;c.connKbps=0;c.connTestMethod=undefined;c.images=[];c.options=c.options||{};var d=c.options,e=d.srcModification||"rebuildSrc",f=d.srcFormat||"{protocol}://{host}{directory}{file}",g=d.testConn||true,h=d.minKbpsForHighSpeedConn||800,i=d.speedTestUri||"http://foresightjs.appspot.com/speed-test/100K.jpg",j=d.speedTestKB||100,k=d.speedTestExpireMinutes||30,l=d.maxBrowserWidth||1024,m=d.maxBrowserHeight||l,n=d.maxRequestWidth||2048,o=d.maxRequestHeight||n,p=d.forcedPixelRatio,q,r,s="loading",t="complete",u="foresight.js",v=false,w=function(){if(q)return;q=s;for(var a=0;a<b.images.length;a++){z(b.images[a])}q=t;C()},x=function(){if(r)return;if(c.devicePixelRatio==1){c.connTestMethod="skip";r=t;return}try{var a=JSON.parse(localStorage.getItem(u));if(a&&a.isHighSpeedConn){var d=((new Date).getTime()-a.timestamp)/1e3/60;if(d<k){c.isHighSpeedConn=true;c.connKbps=a.connKbps;c.connTestMethod="localStorage";r=t;return}}}catch(e){}var f=b.createElement("img"),g,l,m;f.onload=function(){g=(new Date).getTime();var a=H((g-l)/1e3);a=a>1?a:1;var b=j*1024*8;c.connKbps=H(b/a)/1024;c.isHighSpeedConn=c.connKbps>=h;y("networkSuccess")};f.onerror=function(){y("networkError")};l=(new Date).getTime();r=s;if(b.location.protocol==="https:"){i=i.replace("http:","https:")}f.src=i+"?r="+Math.random();m=j*8/h*1e3+250;setTimeout(function(){y("networkSlow")},m)},y=function(a){if(r===t)return;c.connTestMethod=a;try{var b={connKbps:c.connKbps,isHighSpeedConn:c.isHighSpeedConn,timestamp:(new Date).getTime()};localStorage.setItem(u,JSON.stringify(b))}catch(d){}r=t;C()},z=function(a){A(a,"src","orgSrc");if(!a.orgSrc||a.width==0||a.height==0||a.parentElement.clientWidth==0||a.parentElement.clientHeight==0)return;if(!a.initalized){a.initalized=true;a.orgWidth=a.width;a.orgHeight=a.height;a.requestWidth=0;a.requestHeight=0;a.orgClassName=a.className;A(a,"max-width","maxWidth",true,l);A(a,"max-height","maxHeight",true,m);A(a,"max-request-width","maxRequestWidth",true,n);A(a,"max-request-height","maxRequestHeight",true,o);A(a,"width-percent","widthPercent",true,0);A(a,"height-percent","heightPercent",true,0);A(a,"src-modification","srcModification",false,e);A(a,"src-format","srcFormat",false,f);A(a,"pixel-ratio","pixelRatio",true,c.devicePixelRatio);if(!a.id){a.id="fsImg"+Math.round(Math.random()*1e7)}c.images.push(a)}B(a);D(a,"width","maxWidth","height","maxHeight");var b=a.orgClassName?a.orgClassName.split(" "):[];b.push(a.pixelRatio>1?"fs-high-resolution":"fs-standard-resolution");b.push("fs-pixel-ratio-"+a.pixelRatio.toFixed(1).replace(".","_"));a.className=b.join(" ")},A=function(a,b,c,d,e){var f=a.getAttribute("data-"+b);if(f&&f!==""){if(d){f=f.replace("%","");if(!isNaN(f)){f=parseFloat(f,10)}}}else{f=e}a[c]=f},B=function(a){if(a.widthPercent>0){var b=a.width;a.width=H(a.widthPercent/100*a.parentElement.clientWidth);a.height=H(a.height*(a.width/b))}else if(a.heightPercent>0){var c=a.height;a.height=H(a.heightPercent/100*a.parentElement.clientHeight);a.width=H(a.width*(a.height/c))}},C=function(){if(r===t&&q===t){var a,b,d,e,f;for(a=0;a<c.images.length;a++){b=c.images[a];f=false;d=H(b.width*b.pixelRatio);if(d>b.requestWidth){b.requestWidth=d;f=true}e=H(b.height*b.pixelRatio);if(e>b.requestHeight){b.requestHeight=e;f=true}if(f){D(b,"requestWidth","maxRequestWidth","requestHeight","maxRequestHeight");if(b.srcModification==="rebuildSrc"&&b.srcFormat){E(b)}else{G(b)}}}if(c.oncomplete){c.oncomplete()}}},D=function(a,b,c,d,e){var f;if(a[b]>a[c]){f=a[b];a[b]=a[c];a[d]=H(a[d]*(a[b]/f))}if(a[d]>a[e]){f=a[d];a[d]=a[e];a[b]=H(a[b]*(a[d]/f));if(a[b]>a[c]){f=a.img[b];a[b]=a[c];a[d]=H(a[d]*(a[b]/f))}}},E=function(a){var b,c=["protocol","host","port","directory","file","filename","ext","query","requestWidth","requestHeight","pixelRatio"],d=a.srcFormat;a.uri=F(a.orgSrc);a.uri.requestWidth=a.requestWidth;a.uri.requestHeight=a.requestHeight;a.uri.pixelRatio=a.pixelRatio;for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}a.src=d},F=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},G=function(a){a.src=a.orgSrc.replace(a.orgWidth,a.requestWidth).replace(a.orgHeight,a.requestHeight)},H=function(a){return Math.round(a)},I=function(){if(a.addEventListener){a.addEventListener("resize",c.reload,false)}else if(a.attachEvent){a.attachEvent("onresize",c.reload)}},J,K=function(){if(q!==t||r!==t)return;v=true;for(var a=0;a<b.images.length;a++){z(b.images[a])}C()};c.reload=function(){a.clearTimeout(J);J=a.setTimeout(K,250)};if(p){c.devicePixelRatio=p}if(b.readyState===t){w()}else{if(b.addEventListener){b.addEventListener("DOMContentLoaded",w,false);a.addEventListener("load",w,false)}else if(b.attachEvent){b.attachEvent("onreadystatechange",w);a.attachEvent("onload",w)}}x();I()})(this,document)