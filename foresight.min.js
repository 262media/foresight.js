(function(a,b){"use strict";a.foresight=a.foresight||{};var c=a.foresight;c.devicePixelRatio=a.devicePixelRatio&&a.devicePixelRatio>1?a.devicePixelRatio:1;c.availWidth=a.screen.availWidth;c.availHeight=a.screen.availHeight;c.isHighSpeedConn=false;c.connKbps=0;c.connTestMethod=undefined;c.images=[];c.options=c.options||{};var d=c.options,e=d.imgClassName||"responsive-img",f=d.srcModification||"rebuildSrc",g=d.srcFormat||"{protocol}://{host}{directory}{file}",h=d.testConn||true,i=d.minKbpsForHighSpeedConn||800,j=d.speedTestUri||"//foresightjs.appspot.com/speed-test/100K.jpg",k=d.speedTestKB||100,l=d.speedTestExpireMinutes||30,m=d.maxImgWidth||1200,n=d.maxImgHeight||m,o=d.maxImgRequestWidth||2048,p=d.maxImgRequestHeight||o,q=d.forcedPixelRatio;var r,s,t="loading",u="complete",v="foresight.js",w=function(){if(r)return;r=t;var a,c;for(a=0;a<b.images.length;a++){c=b.images[a];if(c.className.indexOf(e)>-1){z(c)}}r=u;C()},x=function(){if(s)return;if(c.devicePixelRatio==1){c.connTestMethod="skip";s=u;return}try{var a=JSON.parse(localStorage.getItem(v));if(a&&a.isHighSpeedConn){var d=((new Date).getTime()-a.timestamp)/1e3/60;if(d<l){c.isHighSpeedConn=true;c.connKbps=a.connKbps;c.connTestMethod="localStorage";s=u;return}}}catch(e){}var f=b.createElement("img"),g,h,m;f.onload=function(){g=(new Date).getTime();var a=H((g-h)/1e3);a=a>1?a:1;var b=k*1024*8;c.connKbps=H(b/a)/1024;c.isHighSpeedConn=c.connKbps>=i;y("network")};f.onerror=function(){y("networkError")};h=(new Date).getTime();s=t;f.src=j+"?r="+Math.random();m=k*8/i*1e3+250;setTimeout(function(){y("networkSlow")},m)},y=function(a){if(s===u)return;c.connTestMethod=a;try{var b={connKbps:c.connKbps,isHighSpeedConn:c.isHighSpeedConn,timestamp:(new Date).getTime()};localStorage.setItem(v,JSON.stringify(b))}catch(d){}s=u;C()},z=function(a){A(a,"src","orgSrc");a.orgWidth=a.width;a.orgHeight=a.height;if(!a.orgSrc||!a.width||!a.height)return;A(a,"max-width","maxWidth",true,m);A(a,"max-height","maxHeight",true,n);A(a,"max-request-width","maxRequestWidth",true,o);A(a,"max-request-height","maxRequestHeight",true,p);A(a,"win-width-percent","winWidthPercent",true,0);A(a,"win-height-percent","winHeightPercent",true,0);B(a);D(a,"width","maxWidth","height","maxHeight");A(a,"src-modification","srcModification",false,f);A(a,"src-format","srcFormat",false,g);A(a,"pixel-ratio","pixelRatio",true,c.devicePixelRatio);c.images.push(a)},A=function(a,b,c,d,e){var f=a.getAttribute("data-"+b);if(f&&f!==""){if(d){f=f.replace("%","");if(!isNaN(f)){f=parseFloat(f,10)}}}else{f=e}a[c]=f},B=function(a){if(a.winWidthPercent>0){var b=a.width;a.width=H(a.winWidthPercent/100*c.availWidth);a.height=H(a.height*(a.width/b))}else if(a.winHeightPercent>0){var d=a.height;a.height=H(a.winHeightPercent/100*c.availHeight);a.width=H(a.width*(a.height/d))}},C=function(){if(s===u&&r===u){var a,b;for(a=0;a<c.images.length;a++){b=c.images[a];b.requestWidth=H(b.width*b.pixelRatio);b.requestHeight=H(b.height*b.pixelRatio);D(b,"requestWidth","maxRequestWidth","requestHeight","maxRequestHeight");if(b.srcModification==="rebuildSrc"&&b.srcFormat){E(b)}else{G(b)}}if(c.oncomplete){c.oncomplete()}}},D=function(a,b,c,d,e){var f;if(a[b]>a[c]){f=a[b];a[b]=a[c];a[d]=H(a[d]*(a[b]/f))}if(a[d]>a[e]){f=a[d];a[d]=a[e];a[b]=H(a[b]*(a[d]/f));if(a[b]>a[c]){f=a.img[b];a[b]=a[c];a[d]=H(a[d]*(a[b]/f))}}},E=function(a){var b,c=["protocol","host","port","directory","file","filename","ext","query","requestWidth","requestHeight","pixelRatio"],d=a.srcFormat;a.uri=F(a.orgSrc);a.uri.requestWidth=a.requestWidth;a.uri.requestHeight=a.requestHeight;a.uri.pixelRatio=a.pixelRatio;for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}a.src=d},F=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},G=function(a){a.src=a.orgSrc.replace(a.orgWidth,a.requestWidth).replace(a.orgHeight,a.requestHeight)},H=function(a){return Math.round(a)};if(q){c.devicePixelRatio=q}if(b.readyState===u){w()}else{if(b.addEventListener){b.addEventListener("DOMContentLoaded",w,false);a.addEventListener("load",w,false)}else if(b.attachEvent){b.attachEvent("onreadystatechange",w);a.attachEvent("onload",w)}}x()})(this,document)