(function(a,b,c){"use strict";a.devicePixelRatio=b.devicePixelRatio&&b.devicePixelRatio>1?b.devicePixelRatio:1;a.isHighSpeedConn=false;a.hiResEnabled=false;a.connKbps=0;a.connTestMethod=undefined;a.images=[];a.options=a.options||{};var d=a.options,e=d.srcModification||"replaceDimensions",f=d.srcFormat||"{protocol}://{host}{directory}{file}",g=d.testConn||true,h=d.minKbpsForHighSpeedConn||800,i=d.speedTestUri||"http://foresightjs.appspot.com/speed-test/100K.jpg",j=d.speedTestKB||100,k=d.speedTestExpireMinutes||30,l=d.maxBrowserWidth||1024,m=d.maxBrowserHeight||l,n=d.maxRequestWidth||2048,o=d.maxRequestHeight||n,p=d.forcedPixelRatio,q,r,s="loading",t="complete",u="fsjs",v=true,w=false,x=function(){if(q)return;q=s;y();q=t;A()},y=function(){var b,d;for(b=0;b<c.images.length;b++){d=c.images[b];if(!d.initalized){d.initalized=v;z(d,"src","orgSrc");z(d,"width","browserWidth");z(d,"height","browserHeight");if(!d.orgSrc||!d.browserWidth||!d.browserHeight)continue;d.orgWidth=d.browserWidth;d.orgHeight=d.browserHeight;d.requestWidth=0;d.requestHeight=0;d.orgClassName=d.className.replace("fs-img","fs-img-ready");z(d,"max-width","maxWidth",v,l);z(d,"max-height","maxHeight",v,m);z(d,"max-request-width","maxRequestWidth",v,n);z(d,"max-request-height","maxRequestHeight",v,o);z(d,"width-percent","widthPercent",v,0);z(d,"height-percent","heightPercent",v,0);z(d,"src-modification","srcModification",w,e);z(d,"src-format","srcFormat",w,f);z(d,"pixel-ratio","pixelRatio",v,a.devicePixelRatio);z(d,"src-high-resolution","highResolution",w);if(!d.id){d.id="fsImg"+H(Math.random()*1e7)}a.images.push(d)}}},z=function(a,b,c,d,e){var f=a.getAttribute("data-"+b);if(f&&f!==""){if(d&&!isNaN(f)){f=parseFloat(f,10)}}else{f=e}a[c]=f},A=function(){if(r===t&&q===t){if(a.isHighSpeedConn&&a.devicePixelRatio>1){a.hiResEnabled=v}var b,c,d,e,f;for(b=0;b<a.images.length;b++){c=a.images[b];c.hiResEnabled=a.isHighSpeedConn&&c.pixelRatio>1;if(c.widthPercent){if(!c.parentElement.clientWidth)continue;var g=c.browserWidth;c.browserWidth=H(c.widthPercent/100*c.parentElement.clientWidth);c.browserHeight=H(c.browserHeight*(c.browserWidth/g))}else if(c.heightPercent){if(!c.parentElement.clientHeight)continue;var h=c.browserHeight;c.browserHeight=H(c.heightPercent/100*c.parentElement.clientHeight);c.browserWidth=H(c.browserWidth*(c.browserHeight/h))}B(c,"browserWidth","maxWidth","browserHeight","maxHeight");if(!c.browserWidth||!c.browserHeight){continue}var i=c.orgClassName?c.orgClassName.split(" "):[];i.push(c.hiResEnabled?"fs-high-resolution":"fs-standard-resolution");i.push("fs-pixel-ratio-"+c.pixelRatio.toFixed(1).replace(".","_"));c.className=i.join(" ");if(c.hiResEnabled){d=H(c.browserWidth*c.pixelRatio);e=H(c.browserHeight*c.pixelRatio)}else{d=c.browserWidth;e=c.browserHeight}f=w;if(d>c.requestWidth){c.requestWidth=d;f=v}if(e>c.requestHeight){c.requestHeight=e;f=v}if(f){B(c,"requestWidth","maxRequestWidth","requestHeight","maxRequestHeight");if(c.highResolution&&a.hiResEnabled){c.src=c.highResolution;c.srcModification="hiResSrc"}else if(c.srcModification==="rebuildSrc"&&c.srcFormat){C(c)}else{E(c)}}c.width=c.browserWidth;c.height=c.browserHeight}if(a.updateComplete){a.updateComplete()}}},B=function(a,b,c,d,e){var f;if(a[b]>a[c]){f=a[b];a[b]=a[c];a[d]=H(a[d]*(a[b]/f))}if(a[d]>a[e]){f=a[d];a[d]=a[e];a[b]=H(a[b]*(a[d]/f));if(a[b]>a[c]){f=a.img[b];a[b]=a[c];a[d]=H(a[d]*(a[b]/f))}}},C=function(a){var b,c=["protocol","host","port","directory","file","filename","ext","query","requestWidth","requestHeight","pixelRatio"],d=a.srcFormat;a.uri=D(a.orgSrc);a.uri.requestWidth=a.requestWidth;a.uri.requestHeight=a.requestHeight;a.uri.pixelRatio=a.pixelRatio;for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}a.src=d},D=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},E=function(a){a.src=a.orgSrc.replace(a.orgWidth,a.requestWidth).replace(a.orgHeight,a.requestHeight)},F=function(){if(r)return;if(a.devicePixelRatio===1){a.connTestMethod="skip";r=t;return}try{var b=JSON.parse(localStorage.getItem(u));if(b&&b.isHighSpeedConn){var d=((new Date).getTime()-b.timestamp)/1e3/60;if(d<k){a.isHighSpeedConn=v;a.connKbps=b.connKbps;a.connTestMethod="localStorage";r=t;return}}}catch(e){}var f=c.createElement("img"),g,l,m;f.onload=function(){g=(new Date).getTime();var b=H((g-l)/1e3);b=b>1?b:1;var c=j*1024*8;a.connKbps=H(c/b)/1024;a.isHighSpeedConn=a.connKbps>=h;G("networkSuccess")};f.onerror=function(){G("networkError")};l=(new Date).getTime();r=s;if(c.location.protocol==="https:"){i=i.replace("http:","https:")}f.src=i+"?r="+Math.random();m=j*8/h*1e3+250;setTimeout(function(){G("networkSlow")},m)},G=function(b){if(r===t)return;a.connTestMethod=b;try{var c={connKbps:a.connKbps,isHighSpeedConn:a.isHighSpeedConn,timestamp:(new Date).getTime()};localStorage.setItem(u,JSON.stringify(c))}catch(d){}r=t;A()},H=function(a){return Math.round(a)},I=function(){if(b.addEventListener){b.addEventListener("resize",a.reload,w)}else if(b.attachEvent){b.attachEvent("onresize",a.reload)}},J,K=function(){if(q!==t||r!==t)return;y();A()};a.reload=function(){b.clearTimeout(J);J=b.setTimeout(K,100)};if(p){a.devicePixelRatio=p}if(c.readyState===t){x()}else{if(c.addEventListener){c.addEventListener("DOMContentLoaded",x,w);b.addEventListener("load",x,w)}else if(c.attachEvent){c.attachEvent("onreadystatechange",x);b.attachEvent("onload",x)}}F();I()})(this.foresight=this.foresight||{},this,document)